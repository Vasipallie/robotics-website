<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | GIIS Robotics Club</title>
  <link rel="icon" type="image/x-icon" href="resources/favicon.ico">
  <style>
    
        @font-face {
            font-family: 'crest';
            src: url('/crst.otf') format('opentype');
        }
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
body{
    color: #ffffff;
    width: 100%;
    max-height: 100vh; 
    background-color: #111111;
    font-family: "crest";
    color: #ffffff;
    display: flex;
    background-image: url('logo/background.png');

}
.h1 { font-size: 10vh; font-family: 'crest', sans-serif; }
.h2 { font-size: 6vh; font-family: 'crest', sans-serif; }
.h3 { font-size: 5vh; font-family: 'crest', sans-serif; }
.h4 { font-size: 3vh; font-family: 'crest', sans-serif; }
.h5 { font-size: 1vh; font-family: 'crest', sans-serif; }
.h6 { font-size: 1vh; font-family: 'crest', sans-serif; }

    
    .nav{
        min-height:100vh ;
        width: 25%;
        background: linear-gradient(180deg, rgba(20, 33, 61, 0.7) 51%, rgba(30, 30, 47, 0.7) 100%);
        padding: 10px;
        display: flex;
        backdrop-filter: blur(10px);
        flex-direction: column;
        align-items: center;
    }
    .imgi{
        margin-bottom: 10px;
    }
    hr{
        width: 100%;
        border: 0;
        height: 1px;
        background-color: aliceblue;
        border-radius: 6px;
        margin-bottom: 10px;
    }
    .btn{
        width:100%;
        height: 6vh;
        cursor: pointer;
        background: #1E201F;
        color: #ffffff;
        font-family: 'crest';
        text-align: left;
        padding: 8px 10px;
        font-size: 2.6vh;
        border-radius: 12px;
        border: 0;
        background: linear-gradient(130deg, rgba(30, 32, 31, 1) 56%,#270d40d7 100%) padding-box, linear-gradient(130deg, #7f7f7f, #282a29) border-box;
        border: 2px solid transparent;
        margin-bottom: 8px;
        transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.12s ease, border-color 0.2s ease;
    }
    .btn:hover{
        box-shadow: 0 8px 16px rgba(0,0,0,0.25);
        transform: translateX(2px);
        border-color: #9aa3a0;
    }
    .btn:active{
        transform: translateX(0);
        box-shadow: 0 4px 8px rgba(0,0,0,0.18) inset;
    }
    .btn:focus-visible{
        outline: 2px solid #6c63ff;
        outline-offset: 2px;
    }
    .btna{
        width:100%;
        height: 6vh;
        cursor: pointer;
        background: #1E201F;
        color: #ffffff;
        font-family: 'crest';
        text-align: left;
        padding: 8px 10px;
        font-size: 2.6vh;
        border-radius: 12px;
        border: 0;
        background: linear-gradient(180deg,rgba(82, 108, 218, 1) 0%, rgba(44, 75, 205, 1) 24%, rgba(82, 108, 218, 1) 71%, rgba(82, 108, 218, 1) 100%) padding-box, linear-gradient(to right, #2c4bcd, #2c4bcd) border-box;
        border: 2px solid transparent;
        margin-bottom: 8px;
        transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.12s ease, border-color 0.2s ease;
    }
    .btna:hover{
        background: linear-gradient(180deg,rgba(98, 122, 230, 1) 0%, rgba(54, 85, 215, 1) 24%, rgba(98, 122, 230, 1) 71%, rgba(98, 122, 230, 1) 100%) padding-box, linear-gradient(to right, #3a58e0, #3a58e0) border-box;
        box-shadow: 0 10px 20px rgba(66, 84, 214, 0.35);
        transform: translateX(2px);
    }
    .btna:active{
        transform: translateX(0);
        box-shadow: 0 4px 8px rgba(66, 84, 214, 0.25) inset;
    }
    .btna:focus-visible{
        outline: 2px solid #6c63ff;
        outline-offset: 2px;
    }
    .labels{
        width: 100%;
        text-align: left;
        font-size: 2vh;
        color:#bfbfbf;
        margin-bottom: 5px;
    }
    .hamburger {
        display: none;
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(20, 33, 61, 0.9);
        border: none;
        color: white;
        font-size: 24px;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        z-index: 1001;
    }

    .hamburger:hover {
        background: rgba(108, 99, 255, 0.8);
        transform: scale(1.05);
    }

    .hamburger:active {
        transform: scale(0.95);
    }

    .mobile-nav {
        display: none;
        position: fixed;
        inset: 0;
        background: linear-gradient(180deg, rgba(20, 33, 61, 0.96) 45%, rgba(30, 30, 47, 0.96) 100%);
        backdrop-filter: blur(18px);
        -webkit-backdrop-filter: blur(18px);
        z-index: 1000;
        overflow-y: auto;
    }

    .mobile-nav.active {
        display: flex;
    }

    .mobile-nav-inner {
        width: 100%;
        max-width: 420px;
        margin: 0 auto;
        padding: 80px 32px 48px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
    }

    .mobile-nav-logo {
        width: clamp(140px, 45vw, 220px);
    }

    .mobile-nav-divider {
        width: 100%;
        height: 1px;
        background: rgba(255,255,255,0.3);
        border: 0;
        border-radius: 999px;
    }

    .mobile-nav-label {
        align-self: flex-start;
        font-size: clamp(0.85rem, 2vw, 1rem);
        letter-spacing: 1px;
        text-transform: uppercase;
        color: #bfbfbf;
        margin-top: 4px;
    }

    .mobile-nav-links {
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 100%;
    }

    .mobile-nav-link {
        display: block;
        width: 100%;
        padding: 14px 18px;
        border-radius: 12px;
        border: 2px solid transparent;
        background: linear-gradient(130deg, rgba(30,32,31,0.95) 56%, rgba(39,13,64,0.9) 100%) padding-box, linear-gradient(130deg, #7f7f7f, #282a29) border-box;
        color: #ffffff;
        text-decoration: none;
        font-size: clamp(1rem, 2.6vw, 1.3rem);
        box-shadow: 0 8px 18px rgba(0,0,0,0.3);
        transition: transform 0.18s ease, box-shadow 0.25s ease, border-color 0.25s ease, background 0.25s ease;
    }

    .mobile-nav-link:hover,
    .mobile-nav-link:focus-visible {
        transform: translateX(4px);
        box-shadow: 0 12px 24px rgba(0,0,0,0.35);
        border-color: rgba(154,163,160,0.9);
        outline: none;
    }

    .mobile-nav-link:active {
        transform: translateX(1px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.28) inset;
    }

    .mobile-nav-link.active {
        background: linear-gradient(180deg, rgba(82,108,218,1) 0%, rgba(44,75,205,1) 24%, rgba(82,108,218,1) 71%, rgba(82,108,218,1) 100%) padding-box, linear-gradient(to right, #2c4bcd, #2c4bcd) border-box;
        box-shadow: 0 14px 28px rgba(66,84,214,0.35);
    }

    .main{
        height: 100vh;
        width: 80%;
        padding: 18px 26px 40px 26px;
        overflow-y: auto;
    }
    .subtext{
        font-size: 3vh;
    }
    .shortener{
        margin-top: 30px;
        display: flex;
        flex-direction: column;
        gap: 30px;
    }
    .card{
        width: 100%;
        background: linear-gradient(135deg, rgba(35,35,55,0.75), rgba(25,18,40,0.75));
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        border: 1px solid rgba(255,255,255,0.12);
        border-radius: 22px;
        padding: 28px 30px 34px 30px;
        position: relative;
        box-shadow: 0 18px 40px -10px rgba(0,0,0,0.55), 0 4px 10px rgba(0,0,0,0.4);
        overflow: hidden;
    }
    .card:before{
        content:"";
        position:absolute;
        inset:0;
        background: radial-gradient(circle at 85% 15%, rgba(108,99,255,0.35), transparent 60%);
        pointer-events:none;
        opacity:0.6;
    }
    .card h2{
        margin:0 0 18px 0;
        font-size: clamp(2rem,3.4vw,2.6rem);
        letter-spacing:1px;
    }
    form.short-form{
        display:flex;
        flex-wrap:wrap;
        gap:14px;
        align-items:center;
    }
    .field-group{
        flex:1 1 380px;
        display:flex;
        flex-direction:column;
        gap:6px;
        min-width:260px;
    }
    .field-group label{
        font-size:1.5vh;
        color:#bfbfe8;
        letter-spacing:0.5px;
    }
    .input{
        width:100%;
        padding:14px 16px;
        font-size:1.9vh;
        font-family:'crest';
        border-radius:14px;
        border:2px solid rgba(150,150,170,0.25);
        background:rgba(255,255,255,0.08);
        color:#fff;
        outline:none;
        transition:border-color .25s ease, box-shadow .25s ease, background .25s ease;
    }
    .input:focus{
        border-color:#6c63ff;
        box-shadow:0 0 0 4px rgba(108,99,255,0.25);
        background:rgba(255,255,255,0.12);
    }
    .input::placeholder{color:#b3b3c9;}
    .submit-btn{
        padding:16px 30px;
        font-size:2vh;
        font-family:'crest';
        border-radius:999px;
        border:0;
        cursor:pointer;
        background:linear-gradient(135deg,#6c63ff,#4a47a3);
        color:#fff;
        font-weight:600;
        letter-spacing:0.8px;
        position:relative;
        transition:background .25s ease, transform .18s ease, box-shadow .25s ease;
        box-shadow:0 10px 24px -6px rgba(108,99,255,0.55);
    }
    .submit-btn:hover{background:linear-gradient(135deg,#5a52d5,#3e3b8a);transform:translateY(-3px);box-shadow:0 16px 34px -8px rgba(108,99,255,0.6);}    
    .submit-btn:active{transform:translateY(0);box-shadow:0 8px 18px -4px rgba(108,99,255,0.5);}    
    .list-card{
        width:100%;
        background:linear-gradient(135deg, rgba(30,30,50,0.8), rgba(24,16,38,0.8));
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border:1px solid rgba(255,255,255,0.12);
        border-radius:20px;
        padding:22px 26px 28px 26px;
        box-shadow:0 14px 34px -10px rgba(0,0,0,0.55);
        position:relative;
    }
    .list-card h3{
        margin:0 0 18px 0; font-size: clamp(1.4rem,2.7vw,2rem);
    }   
    .url-list{
        list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:14px;
    }
    .url-item{display:flex;flex-wrap:wrap;gap:10px;align-items:center;background:rgba(255,255,255,0.06);padding:12px 16px;border-radius:14px;border:1px solid rgba(255,255,255,0.08);position:relative;}
    .original-link,.short-link{max-width:46%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:1.65vh;}
    .original-link{color:#c5c5d9;}
    .short-link{color:#4caf50;font-weight:600;}
    .actions{margin-left:auto;display:flex;gap:8px;}
    .copy-btn,.open-btn{background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.25);color:#fff;padding:6px 14px;font-size:1.4vh;border-radius:8px;cursor:pointer;font-family:'crest';transition:background .25s ease, transform .18s ease;}
    .copy-btn:hover,.open-btn:hover{background:rgba(255,255,255,0.28);transform:translateY(-2px);}    
    .copy-btn:active,.open-btn:active{transform:translateY(0);}   
    .empty-note{font-size:1.7vh;color:#bfbfe0;}
    .toast{position:fixed;bottom:26px;right:26px;background:linear-gradient(135deg,#6c63ff,#4a47a3);color:#fff;padding:14px 20px;border-radius:14px;font-size:1.6vh;font-family:'crest';box-shadow:0 10px 26px -6px rgba(0,0,0,0.55);opacity:0;transform:translateY(12px);pointer-events:none;transition:opacity .35s ease, transform .35s ease;}
    .toast.show{opacity:1;transform:translateY(0);}
    .user-manager-content{display:none;flex-direction:column;gap:30px;margin-top:30px;}
    .user-manager-content.active{display:flex;}
    .manager-controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center;}
    .toggle-add-btn{
        padding:12px 24px;
        font-size:1.8vh;
        font-family:'crest';
        border-radius:12px;
        border:0;
        cursor:pointer;
        background:linear-gradient(135deg,#4caf50,#388e3c);
        color:#fff;
        font-weight:600;
        letter-spacing:0.8px;
        transition:background .25s ease, transform .18s ease, box-shadow .25s ease;
        box-shadow:0 8px 20px -6px rgba(76,175,80,0.55);
    }
    .toggle-add-btn:hover{background:linear-gradient(135deg,#45a049,#2e7d32);transform:translateY(-2px);box-shadow:0 12px 28px -8px rgba(76,175,80,0.6);}
    .toggle-add-btn:active{transform:translateY(0);box-shadow:0 6px 16px -4px rgba(76,175,80,0.5);}
    .lock-manager-btn{
        padding:12px 24px;
        font-size:1.8vh;
        font-family:'crest';
        border-radius:12px;
        border:0;
        cursor:pointer;
        background:linear-gradient(135deg,#f44336,#d32f2f);
        color:#fff;
        letter-spacing:0.8px;
        transition:background .25s ease, transform .18s ease, box-shadow .25s ease;
        box-shadow:0 8px 20px -6px rgba(244,67,54,0.55);
    }
    .lock-manager-btn:hover{background:linear-gradient(135deg,#e53935,#c62828);transform:translateY(-2px);box-shadow:0 12px 28px -8px rgba(244,67,54,0.6);}
    .lock-manager-btn:active{transform:translateY(0);box-shadow:0 6px 16px -4px rgba(244,67,54,0.5);}
    .user-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:14px;}
    .user-item{display:flex;flex-wrap:wrap;gap:12px;align-items:center;background:rgba(255,255,255,0.06);padding:14px 18px;border-radius:16px;border:1px solid rgba(255,255,255,0.08);position:relative;}
    .user-main{display:flex;flex-direction:column;gap:4px;min-width:220px;}
    .user-name{font-size:1.9vh;font-weight:600;color:#ffffff;letter-spacing:0.3px;}
    .user-email{font-size:1.6vh;color:#c5c5d9;word-break:break-all;}
    .user-meta{display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
    .dept-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;font-size:1.5vh;background:rgba(108,99,255,0.18);border:1px solid rgba(108,99,255,0.35);border-radius:999px;color:#d0d0ff;letter-spacing:0.3px;}
    .user-id{font-size:1.35vh;color:rgba(255,255,255,0.55);}
    .user-actions{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap;}
    .delete-btn{background:rgba(244,67,54,0.15);border:1px solid rgba(244,67,54,0.25);color:#f44336;padding:8px 16px;font-size:1.5vh;border-radius:10px;font-family:'crest';cursor:pointer;transition:background .25s ease, transform .18s ease;}
    .delete-btn:hover{background:rgba(244,67,54,0.28);transform:translateY(-2px);}
    .delete-btn:active{transform:translateY(0);}
    .user-actions button:disabled{opacity:0.6;cursor:not-allowed;}
    .cancel-btn{padding:14px 24px;font-size:2vh;font-family:'crest';border-radius:999px;border:1px solid rgba(255,255,255,0.25);background:rgba(255,255,255,0.1);color:#fff;cursor:pointer;transition:background .25s ease, transform .18s ease, box-shadow .25s ease;}
    .cancel-btn:hover{background:rgba(255,255,255,0.2);transform:translateY(-2px);box-shadow:0 12px 28px -8px rgba(255,255,255,0.35);}
    .cancel-btn:active{transform:translateY(0);}
    @media (max-width:1080px){
        .nav{width:270px;}
        .main{width:calc(100% - 270px);}
        .url-item{flex-direction:column;align-items:flex-start;}
        .original-link,.short-link{max-width:100%;}
        .actions{width:100%;justify-content:flex-start;margin-left:0;}
        .user-item{flex-direction:column;align-items:flex-start;}
        .user-actions{width:100%;justify-content:flex-start;margin-left:0;}
    }
    @media (max-width:760px){
        body{display:block;}
        .nav{display:none;}
        .hamburger{display:block;}
        .main{width:100%;height:auto;padding:90px 20px 40px 20px;}
        .shortener{margin-top:20px;}
        .user-actions{justify-content:flex-start;}
        .user-item{width:100%;}
    }
    .master-content{
        backdrop-filter: blur(5px);
        width: 420px;
        height: 440px;
        margin: auto;
        margin-top: 50px;
        margin-bottom: 0;
        display: flex;
        flex-direction: column;
        border: 1px solid #a1a1a1;
        background-color: rgba(11, 0, 16, 0.746);
        border-radius: 10px;
        padding: 20px;
        gap: 0;
    }
    .master-text{
        font-size: xx-large;
        font-family: 'crest';
        font-weight: bold;
    }
    .master-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 20px;
    }
    .master-label {
        font-size: 16px;
        color: #ffffff;
        margin-bottom: 5px;
    }
    .master-input {
        padding: 12px;
        border: 2px solid #444;
        border-radius: 8px;
        background-color: rgba(255, 255, 255, 0.1);
        color: #ffffff;
        font-size: 10px;
        font-family: 'crest';
        transition: border-color 0.3s ease;
    }
    .master-input:focus {
        outline: none;
        border-color: #6c63ff;
        box-shadow: 0 0 8px rgba(108, 99, 255, 0.3);
    }
    .master-submit {
        padding: 12px 20px;
        background: linear-gradient(135deg, #6c63ff, #4a47a3);
        color: #ffffff;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-family: 'crest';
        cursor: pointer;
        transition: background 0.3s ease, transform 0.2s ease;
        margin-top: 10px;
    }
    .master-submit:hover {
        background: linear-gradient(135deg, #5a52d5, #3e3b8a);
        transform: translateY(-2px);
    }
    .master-submit:active {
        transform: translateY(0);
    }
    .code-input-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin: 20px 0;
    }
    .code-input {
        width: 50px;
        height: 50px;
        text-align: center;
        font-size: 16px;
        font-weight: bold;
        border: 2px solid #444;
        border-radius: 8px;
        background-color: rgba(255, 255, 255, 0.1);
        color: #ffffff;
        font-family: 'crest';
        transition: border-color 0.3s ease;
        text-transform: uppercase;
    }
    .code-input:focus {
        outline: none;
        border-color: #6c63ff;
        box-shadow: 0 0 8px rgba(108, 99, 255, 0.3);
    }
    .code-input:valid {
        border-color: #4CAF50;
    }
    .error {
        color: #ff4d4d;
        font-size: 14px;
        margin-top: 10px;
    }
    @media (max-width: 480px) {
        .master-content {
            width: 90%;
            height: auto;
            margin-top: 20px;
            padding: 15px;
        }
        .code-input {
            width: 45px;
            height: 45px;
            font-size: 14px;
        }
        .hamburger {
            top: 16px;
            left: 16px;
        }
        .mobile-nav-inner {
            padding: 72px 20px 32px;
        }
        .mobile-nav-link {
            font-size: clamp(1rem, 4.6vw, 1.25rem);
        }
        .main {
            padding: 80px 16px 32px 16px;
        }
    }

    .toast{position:fixed;bottom:26px;right:26px;background:linear-gradient(135deg,#6c63ff,#4a47a3);color:#fff;padding:14px 20px;border-radius:14px;font-size:1.6vh;font-family:'crest';box-shadow:0 10px 26px -6px rgba(0,0,0,0.55);opacity:0;transform:translateY(12px);pointer-events:none;transition:opacity .35s ease, transform .35s ease;}
    .toast.show{opacity:1;transform:translateY(0);}
  </style>
</head>
<body>
    <button class="hamburger" onclick="toggleMobileNav()" aria-label="Toggle navigation">â˜°</button>

    <div class="mobile-nav" id="mobileNav" role="navigation" aria-label="User manager navigation">
        <div class="mobile-nav-inner">
            <img class="mobile-nav-logo" src="logo/logot.png" alt="GIIS Robotics Logo">
            <hr class="mobile-nav-divider">
            <span class="mobile-nav-label">Menu</span>
            <div class="mobile-nav-links">
                <a class="mobile-nav-link" href="/dashboard" onclick="closeMobileNav()">Dashboard</a>
                <a class="mobile-nav-link active" href="/usermgr" onclick="closeMobileNav()">User Manager</a>
                <a class="mobile-nav-link" href="/socialsmanager" onclick="closeMobileNav()">Password Manager</a>
                <a class="mobile-nav-link" href="/urlshortener" onclick="closeMobileNav()">URL Shortener</a>
                <a class="mobile-nav-link" href="https://drive.google.com/drive/folders/1RafsSvXM_gKINRmUk5dVvak85THhwBCO?usp=sharing" onclick="closeMobileNav()">Robotics Drive</a>
                <a class="mobile-nav-link" href="/qrgen" onclick="closeMobileNav()">QR Code Generator</a>
            </div>
            <span class="mobile-nav-label">Logout</span>
            <div class="mobile-nav-links">
                <a class="mobile-nav-link" href="/logout" onclick="closeMobileNav()">Logout</a>
            </div>
        </div>
    </div>

    <div class="nav">
        <img class="imgi" src="logo/logot.png" alt="GIIS Robotics Logo" width="70%">
        <hr>
        <span class="labels">Menu</span>
        <button class="btn" onclick="window.location.href = '/dashboard';">Dashboard</button>
        <button class="btna" onclick="window.location.href = '/usermgr';">User Manager</button>
        <button class="btn" onclick="window.location.href = '/socialsmanager';">Password Manager</button>
        <button class="btn" onclick="window.location.href = 'https://drive.google.com/drive/folders/1RafsSvXM_gKINRmUk5dVvak85THhwBCO?usp=sharing';">Robotics Drive</button>
        <button class="btn" onclick="window.location.href = '/urlshortener';">Url Shortener</button>
        <button class="btn" onclick="window.location.href = '/qrgen';">QR Code Generator</button>

        <span class="labels">Logout</span>
        <button class="btn" onclick="window.location.href = '/logout';">Logout</button>
    </div> 
    <div class="main">
        <h1 class="h2">Welcome, <%= locals.name %>!</h1>
        <span class="subtext">Department of <%= locals.dept %></span>
        <hr style="margin:26px 0 10px 0; border:0; height:2px; background:linear-gradient(90deg,#6c63ff,#4a47a3); border-radius:4px;" />
        
        <div class="master-content" id="masterKeyCard">
            <img src="logo/logo-white.png" alt="GIIS Robotics Club Logo" width="80" height="80">
            <span class="master-text">User Management</span>
            <span class="error"><%= locals.error || '' %></span>
            <hr>
            <form class="master-form" id="masterKeyForm">
                <label class="master-label" for="reset-code">Enter Master Key:</label>
                <div class="code-input-container">
                    <input type="text" class="code-input" name="code1" id="code1" maxlength="4" required>
                    <input type="text" class="code-input" name="code2" id="code2" maxlength="4" required>
                    <input type="text" class="code-input" name="code3" id="code3" maxlength="4" required>
                    <input type="text" class="code-input" name="code4" id="code4" maxlength="4" required>
                    <input type="text   " class="code-input" name="code5" id="code5" maxlength="4" required>
                </div>
                <input type="submit" class="master-submit" value="Access User Manager">
            </form>
        </div>


        <div class="shortener user-manager-content" id="userManagerContent">
            <div class="manager-controls">
                <button class="toggle-add-btn" id="toggleAddBtn" type="button">Add account</button>
                <button class="lock-manager-btn" id="lockManagerBtn" type="button">Lock manager</button>
            </div>
            <div class="card user-form-card" id="addUserCard" style="display:none;">
                <h2>Create a new account</h2>
                <form class="short-form" id="addUserForm">
                    <div class="field-group">
                        <label for="userName">Full name</label>
                        <input class="input" type="text" id="userName" name="userName" placeholder="Alex Robotics" required>
                    </div>
                    <div class="field-group">
                        <label for="userDept">Department</label>
                        <input class="input" type="text" id="userDept" name="userDept" placeholder="Mechanical" required>
                    </div>
                    <div class="field-group">
                        <label for="userEmail">Email address</label>
                        <input class="input" type="email" id="userEmail" name="userEmail" placeholder="alex@giisclubs.org" required>
                    </div>
                    <div class="field-group">
                        <label for="userPassword">Temporary password</label>
                        <input class="input" type="password" id="userPassword" name="userPassword" placeholder="Enter password" autocomplete="new-password" required>
                    </div>
                    <div class="field-group">
                        <label for="userPasswordConfirm">Confirm password</label>
                        <input class="input" type="password" id="userPasswordConfirm" name="userPasswordConfirm" placeholder="Re-enter password" autocomplete="new-password" required>
                    </div>
                    <button class="submit-btn" type="submit">Create account</button>
                </form>
            </div>
            <div class="list-card user-list-card">
                <h3>Active accounts</h3>
                <p class="empty-note" id="userEmptyState" style="display:none;">No accounts yet. Add your first member.</p>
                <ul class="user-list" id="userList"></ul>
            </div>
        </div>


        <div class="toast" id="toast">Master key verification complete</div>

    </div>
    <script>
        function toggleMobileNav() {
            const mobileNav = document.getElementById('mobileNav');
            if (mobileNav) {
                mobileNav.classList.toggle('active');
            }
        }

        function closeMobileNav() {
            const mobileNav = document.getElementById('mobileNav');
            if (mobileNav) {
                mobileNav.classList.remove('active');
            }
        }

        document.addEventListener('click', function(event) {
            const mobileNav = document.getElementById('mobileNav');
            const hamburger = document.querySelector('.hamburger');

            if (mobileNav &&
                hamburger &&
                !mobileNav.contains(event.target) &&
                !hamburger.contains(event.target) &&
                mobileNav.classList.contains('active')) {
                closeMobileNav();
            }
        });

        const masterKeyCard = document.getElementById('masterKeyCard');
        const userManagerContent = document.getElementById('userManagerContent');
        const toggleAddBtn = document.getElementById('toggleAddBtn');
        const addUserCard = document.getElementById('addUserCard');
        const addUserForm = document.getElementById('addUserForm');
        const lockManagerBtn = document.getElementById('lockManagerBtn');
        const userList = document.getElementById('userList');
        const userEmptyState = document.getElementById('userEmptyState');
        const masterKeyForm = document.getElementById('masterKeyForm');

        let currentMasterKey = '';
        let userCache = [];
        let addFormVisible = false;

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeMobileNav();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('.code-input');

            inputs.forEach((input, index) => {
                input.addEventListener('input', function() {
                    if (this.value.length === 4 && index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    }
                });

                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && this.value.length === 0 && index > 0) {
                        inputs[index - 1].focus();
                    }

                    if (!/[a-zA-Z0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                        e.preventDefault();
                    }
                });

                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text');
                    const cleanPaste = paste.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();

                    for (let i = 0; i < inputs.length && i * 4 < cleanPaste.length; i++) {
                        const chunk = cleanPaste.substr(i * 4, 4);
                        inputs[i].value = chunk;
                    }

                    const nextEmpty = Array.from(inputs).find(inp => inp.value.length < 4);
                    if (nextEmpty) {
                        nextEmpty.focus();
                    } else {
                        inputs[inputs.length - 1].focus();
                    }
                });
            });

            if (inputs.length > 0) {
                inputs[0].focus();
            }
        });

        if (toggleAddBtn) {
            toggleAddBtn.addEventListener('click', function() {
                setAddFormVisibility(!addFormVisible);
            });
        }

        if (lockManagerBtn) {
            lockManagerBtn.addEventListener('click', function() {
                lockManager();
            });
        }

        if (addUserForm) {
            addUserForm.addEventListener('submit', function(e) {
                e.preventDefault();

                if (!currentMasterKey) {
                    showToast('Enter the master key first');
                    return;
                }

                const nameInput = document.getElementById('userName');
                const deptInput = document.getElementById('userDept');
                const emailInput = document.getElementById('userEmail');
                const passwordInput = document.getElementById('userPassword');
                const passwordConfirmInput = document.getElementById('userPasswordConfirm');

                const name = nameInput ? nameInput.value.trim() : '';
                const dept = deptInput ? deptInput.value.trim() : '';
                const email = emailInput ? emailInput.value.trim() : '';
                const password = passwordInput ? passwordInput.value : '';
                const confirmPassword = passwordConfirmInput ? passwordConfirmInput.value : '';

                if (!name || !dept || !email || !password || !confirmPassword) {
                    showToast('All fields are required');
                    return;
                }

                if (password !== confirmPassword) {
                    showToast('Passwords do not match');
                    return;
                }

                const submitBtn = addUserForm.querySelector('.submit-btn');
                const originalText = submitBtn ? submitBtn.textContent : '';
                if (submitBtn) {
                    submitBtn.textContent = 'Creating...';
                    submitBtn.disabled = true;
                }

                fetch('/users/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        masterKey: currentMasterKey,
                        name: name,
                        dept: dept,
                        email: email,
                        password: password
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast(data.message || 'Account created successfully');
                        addUserForm.reset();
                        setAddFormVisibility(false);
                        refreshUsers();
                    } else {
                        showToast(data.message || 'Error creating account');
                    }
                })
                .catch(() => {
                    showToast('Error creating account');
                })
                .finally(() => {
                    if (submitBtn) {
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                    }
                });
            });
        }

        if (masterKeyForm) {
            masterKeyForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const inputs = document.querySelectorAll('.code-input');
                const masterKey = Array.from(inputs).map(input => input.value).join('');

                if (masterKey.length !== 20) {
                    showToast('Please enter a complete 20-character master key');
                    return;
                }

                const submitBtn = masterKeyForm.querySelector('.master-submit');
                const originalText = submitBtn.value;
                submitBtn.value = 'Verifying...';
                submitBtn.disabled = true;

                fetch('/master2users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ masterKey: masterKey })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        currentMasterKey = masterKey;
                        if (masterKeyCard) {
                            masterKeyCard.style.display = 'none';
                        }
                        if (userManagerContent) {
                            userManagerContent.classList.add('active');
                        }
                        renderUserList(Array.isArray(data.users) ? data.users : []);
                        showToast(data.message || 'Master key verified successfully!');
                        if (userManagerContent) {
                            userManagerContent.scrollIntoView({ behavior: 'smooth' });
                        }
                    } else {
                        showToast(data.message || 'Invalid master key');
                    }
                })
                .catch(() => {
                    showToast('Error connecting to server');
                })
                .finally(() => {
                    submitBtn.value = originalText;
                    submitBtn.disabled = false;
                });
            });
        }

        function setAddFormVisibility(visible) {
            addFormVisible = visible;
            if (addUserCard) {
                addUserCard.style.display = visible ? 'block' : 'none';
            }
            if (toggleAddBtn) {
                toggleAddBtn.textContent = visible ? 'Hide form' : 'Add account';
            }
            if (visible) {
                const nameInput = document.getElementById('userName');
                if (nameInput) {
                    nameInput.focus();
                }
            }
        }

        function lockManager() {
            currentMasterKey = '';
            userCache = [];
            setAddFormVisibility(false);
            renderUserList([]);
            if (userManagerContent) {
                userManagerContent.classList.remove('active');
            }
            if (masterKeyCard) {
                masterKeyCard.style.display = 'flex';
            }
            const inputs = document.querySelectorAll('.code-input');
            inputs.forEach(input => {
                input.value = '';
            });
            if (inputs.length > 0) {
                inputs[0].focus();
            }
            showToast('User manager locked');
        }

        function renderUserList(users) {
            if (!userList || !userEmptyState) {
                return;
            }

            userCache = Array.isArray(users) ? users : [];
            userList.innerHTML = '';

            if (!userCache.length) {
                userEmptyState.style.display = 'block';
                return;
            }

            userEmptyState.style.display = 'none';

            userCache.forEach(user => {
                const item = document.createElement('li');
                item.className = 'user-item';

                const main = document.createElement('div');
                main.className = 'user-main';

                const nameSpan = document.createElement('span');
                nameSpan.className = 'user-name';
                nameSpan.textContent = user.name || 'Unknown member';

                const emailSpan = document.createElement('span');
                emailSpan.className = 'user-email';
                emailSpan.textContent = user.email || 'No email provided';

                main.appendChild(nameSpan);
                main.appendChild(emailSpan);

                const meta = document.createElement('div');
                meta.className = 'user-meta';

                const deptBadge = document.createElement('span');
                deptBadge.className = 'dept-badge';
                deptBadge.textContent = user.dept ? user.dept : 'Unknown';

                const idSpan = document.createElement('span');
                idSpan.className = 'user-id';
                idSpan.textContent = user.id ? `ID: ${user.id}` : 'ID unavailable';

                meta.appendChild(deptBadge);
                meta.appendChild(idSpan);

                const actions = document.createElement('div');
                actions.className = 'user-actions';

                const deleteBtn = document.createElement('button');
                deleteBtn.type = 'button';
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', function() {
                    const confirmed = window.confirm('Delete account for ' + (user.name || 'this member') + '?');
                    if (confirmed) {
                        deleteUser(user.id);
                    }
                });

                actions.appendChild(deleteBtn);

                item.appendChild(main);
                item.appendChild(meta);
                item.appendChild(actions);

                userList.appendChild(item);
            });
        }

        function deleteUser(userId) {
            if (!currentMasterKey) {
                showToast('Enter the master key first');
                return;
            }
            if (!userId) {
                showToast('Missing user identifier');
                return;
            }

            fetch('/users/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    masterKey: currentMasterKey,
                    id: userId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast(data.message || 'User deleted successfully');
                    refreshUsers();
                } else {
                    showToast(data.message || 'Error deleting user');
                }
            })
            .catch(() => {
                showToast('Error deleting user');
            });
        }

        function refreshUsers() {
            if (!currentMasterKey) {
                return;
            }

            fetch('/master2users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ masterKey: currentMasterKey })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    renderUserList(Array.isArray(data.users) ? data.users : []);
                } else {
                    showToast(data.message || 'Unable to refresh users');
                }
            })
            .catch(() => {
                showToast('Error refreshing users');
            });
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            if (!toast) {
                return;
            }
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2600);
        }
    </script>
</body>
</html>