<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>QR Code Generator | GIIS Robotics Club</title>
	<link rel="icon" type="image/x-icon" href="resources/favicon.ico">
	<style>
		@font-face {
			font-family: 'crest';
			src: url('/crst.otf') format('opentype');
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			color: #ffffff;
			width: 100%;
			max-height: 100vh;
			background-color: #111111;
			font-family: 'crest';
			display: flex;
			background-image: url('logo/background.png');
		}

		.h1 { font-size: 10vh; font-family: 'crest', sans-serif; }
		.h2 { font-size: 6vh; font-family: 'crest', sans-serif; }
		.h3 { font-size: 5vh; font-family: 'crest', sans-serif; }
		.h4 { font-size: 3vh; font-family: 'crest', sans-serif; }

		.nav {
			min-height: 100vh;
			width: 25%;
			background: linear-gradient(180deg, rgba(20, 33, 61, 0.7) 51%, rgba(30, 30, 47, 0.7) 100%);
			padding: 10px;
			display: flex;
			backdrop-filter: blur(10px);
			flex-direction: column;
			align-items: center;
		}

		.imgi {
			margin-bottom: 10px;
		}

		hr {
			width: 100%;
			border: 0;
			height: 1px;
			background-color: aliceblue;
			border-radius: 6px;
			margin-bottom: 10px;
		}

		.btn {
			width: 100%;
			height: 6vh;
			cursor: pointer;
			color: #ffffff;
			font-family: 'crest';
			text-align: left;
			padding: 8px 10px;
			font-size: 2.6vh;
			border-radius: 12px;
			border: 0;
			background: linear-gradient(130deg, rgba(30, 32, 31, 1) 56%, #270d40d7 100%) padding-box, linear-gradient(130deg, #7f7f7f, #282a29) border-box;
			border: 2px solid transparent;
			margin-bottom: 8px;
			transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.12s ease, border-color 0.2s ease;
		}

		.btn:hover {
			box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25);
			transform: translateX(2px);
			border-color: #9aa3a0;
		}

		.btn:active {
			transform: translateX(0);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.18) inset;
		}

		.btn:focus-visible {
			outline: 2px solid #6c63ff;
			outline-offset: 2px;
		}

		.btna {
			width: 100%;
			height: 6vh;
			cursor: pointer;
			color: #ffffff;
			font-family: 'crest';
			text-align: left;
			padding: 8px 10px;
			font-size: 2.6vh;
			border-radius: 12px;
			border: 0;
			background: linear-gradient(180deg, rgba(82, 108, 218, 1) 0%, rgba(44, 75, 205, 1) 24%, rgba(82, 108, 218, 1) 71%, rgba(82, 108, 218, 1) 100%) padding-box, linear-gradient(to right, #2c4bcd, #2c4bcd) border-box;
			border: 2px solid transparent;
			margin-bottom: 8px;
			transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.12s ease, border-color 0.2s ease;
		}

		.btna:hover {
			background: linear-gradient(180deg, rgba(98, 122, 230, 1) 0%, rgba(54, 85, 215, 1) 24%, rgba(98, 122, 230, 1) 71%, rgba(98, 122, 230, 1) 100%) padding-box, linear-gradient(to right, #3a58e0, #3a58e0) border-box;
			box-shadow: 0 10px 20px rgba(66, 84, 214, 0.35);
			transform: translateX(2px);
		}

		.btna:active {
			transform: translateX(0);
			box-shadow: 0 4px 8px rgba(66, 84, 214, 0.25) inset;
		}

		.btna:focus-visible {
			outline: 2px solid #6c63ff;
			outline-offset: 2px;
		}

		.labels {
			width: 100%;
			text-align: left;
			font-size: 2vh;
			color: #bfbfbf;
			margin-bottom: 5px;
		}

		.hamburger {
			display: none;
			position: fixed;
			top: 20px;
			left: 20px;
			background: rgba(20, 33, 61, 0.9);
			border: none;
			color: white;
			font-size: 24px;
			padding: 10px;
			border-radius: 8px;
			cursor: pointer;
			backdrop-filter: blur(10px);
			-webkit-backdrop-filter: blur(10px);
			transition: all 0.3s ease;
			z-index: 1001;
		}

		.hamburger:hover {
			background: rgba(108, 99, 255, 0.8);
			transform: scale(1.05);
		}

		.hamburger:active {
			transform: scale(0.95);
		}

		.mobile-nav {
			display: none;
			position: fixed;
			inset: 0;
			background: linear-gradient(180deg, rgba(20, 33, 61, 0.96) 45%, rgba(30, 30, 47, 0.96) 100%);
			backdrop-filter: blur(18px);
			-webkit-backdrop-filter: blur(18px);
			z-index: 1000;
			overflow-y: auto;
		}

		.mobile-nav.active {
			display: flex;
		}

		.mobile-nav-inner {
			width: 100%;
			max-width: 420px;
			margin: 0 auto;
			padding: 80px 32px 48px;
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 16px;
		}

		.mobile-nav-logo {
			width: clamp(140px, 45vw, 220px);
		}

		.mobile-nav-divider {
			width: 100%;
			height: 1px;
			background: rgba(255, 255, 255, 0.3);
			border: 0;
			border-radius: 999px;
		}

		.mobile-nav-label {
			align-self: flex-start;
			font-size: clamp(0.85rem, 2vw, 1rem);
			letter-spacing: 1px;
			text-transform: uppercase;
			color: #bfbfbf;
			margin-top: 4px;
		}

		.mobile-nav-links {
			display: flex;
			flex-direction: column;
			gap: 10px;
			width: 100%;
		}

		.mobile-nav-link {
			display: block;
			width: 100%;
			padding: 14px 18px;
			border-radius: 12px;
			border: 2px solid transparent;
			background: linear-gradient(130deg, rgba(30, 32, 31, 0.95) 56%, rgba(39, 13, 64, 0.9) 100%) padding-box, linear-gradient(130deg, #7f7f7f, #282a29) border-box;
			color: #ffffff;
			text-decoration: none;
			font-size: clamp(1rem, 2.6vw, 1.3rem);
			box-shadow: 0 8px 18px rgba(0, 0, 0, 0.3);
			transition: transform 0.18s ease, box-shadow 0.25s ease, border-color 0.25s ease, background 0.25s ease;
		}

		.mobile-nav-link:hover,
		.mobile-nav-link:focus-visible {
			transform: translateX(4px);
			box-shadow: 0 12px 24px rgba(0, 0, 0, 0.35);
			border-color: rgba(154, 163, 160, 0.9);
			outline: none;
		}

		.mobile-nav-link:active {
			transform: translateX(1px);
			box-shadow: 0 6px 12px rgba(0, 0, 0, 0.28) inset;
		}

		.mobile-nav-link.active {
			background: linear-gradient(180deg, rgba(82, 108, 218, 1) 0%, rgba(44, 75, 205, 1) 24%, rgba(82, 108, 218, 1) 71%, rgba(82, 108, 218, 1) 100%) padding-box, linear-gradient(to right, #2c4bcd, #2c4bcd) border-box;
			box-shadow: 0 14px 28px rgba(66, 84, 214, 0.35);
		}

		.main {
			height: 100vh;
			width: 80%;
			padding: 18px 26px 40px 26px;
			overflow-y: auto;
		}

		.subtext {
			font-size: 3vh;
		}

		.qr-wrapper {
			margin-top: 30px;
			display: flex;
			flex-direction: column;
			gap: 30px;
		}

		.card {
			width: 100%;
			background: linear-gradient(135deg, rgba(35, 35, 55, 0.75), rgba(25, 18, 40, 0.75));
			backdrop-filter: blur(14px);
			-webkit-backdrop-filter: blur(14px);
			border: 1px solid rgba(255, 255, 255, 0.12);
			border-radius: 22px;
			padding: 28px 30px 34px 30px;
			position: relative;
			box-shadow: 0 18px 40px -10px rgba(0, 0, 0, 0.55), 0 4px 10px rgba(0, 0, 0, 0.4);
			overflow: hidden;
		}

		.card:before {
			content: "";
			position: absolute;
			inset: 0;
			background: radial-gradient(circle at 85% 15%, rgba(108, 99, 255, 0.35), transparent 60%);
			pointer-events: none;
			opacity: 0.6;
		}

		.card h2 {
			margin: 0 0 18px 0;
			font-size: clamp(2rem, 3.4vw, 2.6rem);
			letter-spacing: 1px;
		}

		.qr-form {
			display: flex;
			flex-wrap: wrap;
			gap: 18px;
			align-items: center;
		}

		.field-group {
			flex: 1 1 320px;
			display: flex;
			flex-direction: column;
			gap: 6px;
			min-width: 260px;
		}

		.field-group label {
			font-size: 1.5vh;
			color: #bfbfe8;
			letter-spacing: 0.5px;
		}

		.input {
			width: 100%;
			padding: 14px 16px;
			font-size: 1.9vh;
			font-family: 'crest';
			border-radius: 14px;
			border: 2px solid rgba(150, 150, 170, 0.25);
			background: rgba(255, 255, 255, 0.08);
			color: #fff;
			outline: none;
			transition: border-color 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
		}

		.input:focus {
			border-color: #6c63ff;
			box-shadow: 0 0 0 4px rgba(108, 99, 255, 0.25);
			background: rgba(255, 255, 255, 0.12);
		}

		.input::placeholder { color: #b3b3c9; }

		.submit-btn {
			padding: 16px 30px;
			font-size: 2vh;
			font-family: 'crest';
			border-radius: 999px;
			border: 0;
			cursor: pointer;
			background: linear-gradient(135deg, #6c63ff, #4a47a3);
			color: #fff;
			font-weight: 600;
			letter-spacing: 0.8px;
			position: relative;
			transition: background 0.25s ease, transform 0.18s ease, box-shadow 0.25s ease;
			box-shadow: 0 10px 24px -6px rgba(108, 99, 255, 0.55);
		}

		.submit-btn:hover {
			background: linear-gradient(135deg, #5a52d5, #3e3b8a);
			transform: translateY(-3px);
			box-shadow: 0 16px 34px -8px rgba(108, 99, 255, 0.6);
		}

		.submit-btn:active {
			transform: translateY(0);
			box-shadow: 0 8px 18px -4px rgba(108, 99, 255, 0.5);
		}

		.output-card {
			width: 100%;
			background: linear-gradient(135deg, rgba(30, 30, 50, 0.8), rgba(24, 16, 38, 0.8));
			backdrop-filter: blur(10px);
			-webkit-backdrop-filter: blur(10px);
			border: 1px solid rgba(255, 255, 255, 0.12);
			border-radius: 20px;
			padding: 22px 26px 28px 26px;
			box-shadow: 0 14px 34px -10px rgba(0, 0, 0, 0.55);
			position: relative;
			display: flex;
			flex-direction: column;
			gap: 20px;
			align-items: center;
		}

		.qr-preview {
			width: clamp(220px, 40vw, 320px);
			height: clamp(220px, 40vw, 320px);
			border-radius: 18px;
			background: rgba(0, 0, 0, 0.12);
			display: flex;
			align-items: center;
			justify-content: center;
			border: 1px solid rgba(255, 255, 255, 0.1);
		}

		.qr-preview img {
			max-width: 90%;
			max-height: 90%;
			filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.35));
		}

		.qr-placeholder {
			text-align: center;
			color: #bfbfe0;
			font-size: 1.8vh;
		}

		.download-btn {
			padding: 12px 24px;
			background: linear-gradient(135deg, #4caf50, #2e7d32);
			border-radius: 999px;
			border: 0;
			color: #ffffff;
			font-size: 1.8vh;
			font-family: 'crest';
			cursor: pointer;
			box-shadow: 0 10px 24px -6px rgba(76, 175, 80, 0.55);
			transition: background 0.25s ease, transform 0.18s ease, box-shadow 0.25s ease;
			display: none;
		}

		.download-btn:hover {
			background: linear-gradient(135deg, #45a049, #256628);
			transform: translateY(-3px);
			box-shadow: 0 16px 34px -8px rgba(76, 175, 80, 0.6);
		}

		.download-btn:active {
			transform: translateY(0);
			box-shadow: 0 8px 18px -4px rgba(76, 175, 80, 0.5);
		}

		.status-text {
			font-size: 1.6vh;
			color: #bfbfe0;
			text-align: center;
		}

		.toast {
			position: fixed;
			bottom: 26px;
			right: 26px;
			background: linear-gradient(135deg, #6c63ff, #4a47a3);
			color: #fff;
			padding: 14px 20px;
			border-radius: 14px;
			font-size: 1.6vh;
			font-family: 'crest';
			box-shadow: 0 10px 26px -6px rgba(0, 0, 0, 0.55);
			opacity: 0;
			transform: translateY(12px);
			pointer-events: none;
			transition: opacity 0.35s ease, transform 0.35s ease;
		}

		.toast.show {
			opacity: 1;
			transform: translateY(0);
		}

		@media (max-width: 1080px) {
			.nav { width: 270px; }
			.main { width: calc(100% - 270px); }
		}

		@media (max-width: 768px) {
			body { display: block; }
			.nav { display: none; }
			.hamburger { display: block; }
			.main { width: 100%; height: auto; padding: 90px 20px 40px 20px; }
			.qr-wrapper { margin-top: 20px; }
		}

		@media (max-width: 480px) {
			.hamburger { top: 16px; left: 16px; }
			.mobile-nav-inner { padding: 72px 20px 32px; }
			.mobile-nav-link { font-size: clamp(1rem, 4.6vw, 1.25rem); }
			.main { padding: 80px 16px 32px 16px; }
		}
	</style>
</head>
<body>
	<button class="hamburger" onclick="toggleMobileNav()" aria-label="Toggle navigation">☰</button>

	<div class="mobile-nav" id="mobileNav" role="navigation" aria-label="QR generator navigation">
		<div class="mobile-nav-inner">
			<img class="mobile-nav-logo" src="logo/logot.png" alt="GIIS Robotics Logo">
			<hr class="mobile-nav-divider">
			<span class="mobile-nav-label">Menu</span>
			<div class="mobile-nav-links">
				<a class="mobile-nav-link" href="/dashboard" onclick="closeMobileNav()">Dashboard</a>
				<a class="mobile-nav-link" href="/usermgr" onclick="closeMobileNav()">User Manager</a>
				<a class="mobile-nav-link" href="/socialsmanager" onclick="closeMobileNav()">Password Manager</a>
				<a class="mobile-nav-link" href="/urlshortener" onclick="closeMobileNav()">URL Shortener</a>
				<a class="mobile-nav-link active" href="/qrgen" onclick="closeMobileNav()">QR Code Generator</a>
				<a class="mobile-nav-link" href="https://drive.google.com/drive/folders/1RafsSvXM_gKINRmUk5dVvak85THhwBCO?usp=sharing" onclick="closeMobileNav()">Robotics Drive</a>
			</div>
			<span class="mobile-nav-label">Logout</span>
			<div class="mobile-nav-links">
				<a class="mobile-nav-link" href="/logout" onclick="closeMobileNav()">Logout</a>
			</div>
		</div>
	</div>

	<div class="nav">
		<img class="imgi" src="logo/logot.png" alt="GIIS Robotics Logo" width="70%">
		<hr>
		<span class="labels">Menu</span>
		<button class="btn" onclick="window.location.href = '/dashboard';">Dashboard</button>
		<button class="btn" onclick="window.location.href = '/usermgr';">User Manager</button>
		<button class="btn" onclick="window.location.href = '/socialsmanager';">Password Manager</button>
		<button class="btn" onclick="window.location.href = 'https://drive.google.com/drive/folders/1RafsSvXM_gKINRmUk5dVvak85THhwBCO?usp=sharing';">Robotics Drive</button>
		<button class="btn" onclick="window.location.href = '/urlshortener';">URL Shortener</button>
		<button class="btna" onclick="window.location.href = '/qrgen';">QR Code Generator</button>

		<span class="labels">Logout</span>
		<button class="btn" onclick="window.location.href = '/logout';">Logout</button>
	</div>

	<div class="main">
		<h1 class="h2">Welcome, <%= locals.name %>!</h1>
		<span class="subtext">Department of <%= locals.dept %></span>
		<hr style="margin:26px 0 10px 0; border:0; height:2px; background:linear-gradient(90deg,#6c63ff,#4a47a3); border-radius:4px;" />

		<div class="qr-wrapper">
			<div class="card">
				<h2>Generate a QR Code</h2>
				<form class="qr-form" id="qrForm">
					<div class="field-group">
						<label for="qrData">Text or URL</label>
						<input id="qrData" type="text" name="qrData" class="input" placeholder="https://giisclubs.org" required>
					</div>
					<div class="field-group">
						<label for="qrSize">Size (px)</label>
						<input id="qrSize" type="number" name="qrSize" class="input" value="320" min="128" max="640" step="32">
					</div>
					<div class="field-group" style="max-width:200px;">
						<label for="qrColor">Foreground</label>
						<input id="qrColor" type="color" name="qrColor" class="input" value="#000000" style="padding:6px; height:48px; cursor:pointer;">
					</div>
					<div class="field-group" style="max-width:200px;">
						<label for="qrBg">Background</label>
						<input id="qrBg" type="color" name="qrBg" class="input" value="#ffffff" style="padding:6px; height:48px; cursor:pointer;">
					</div>
					<button type="submit" class="submit-btn" id="generateBtn">Generate QR</button>
				</form>
			</div>

			<div class="output-card">
				<div class="qr-preview" id="qrPreviewContainer">
					<div class="qr-placeholder">Your QR code will appear here</div>
				</div>
				<span class="status-text" id="qrStatus">Enter text and tap Generate.</span>
				<button type="button" class="download-btn" id="downloadBtn">Download PNG</button>
			</div>
		</div>

		<div class="toast" id="toast">QR code ready ✓</div>
	</div>

	<script>
		function toggleMobileNav() {
			const mobileNav = document.getElementById('mobileNav');
			mobileNav.classList.toggle('active');
		}

		function closeMobileNav() {
			const mobileNav = document.getElementById('mobileNav');
			mobileNav.classList.remove('active');
		}

		document.addEventListener('click', function(event) {
			const mobileNav = document.getElementById('mobileNav');
			const hamburger = document.querySelector('.hamburger');

			if (mobileNav.classList.contains('active') &&
				!mobileNav.contains(event.target) &&
				!hamburger.contains(event.target)) {
				closeMobileNav();
			}
		});

		document.addEventListener('keydown', function(event) {
			if (event.key === 'Escape') {
				closeMobileNav();
			}
		});

		const qrForm = document.getElementById('qrForm');
		const qrPreviewContainer = document.getElementById('qrPreviewContainer');
		const qrStatus = document.getElementById('qrStatus');
		const downloadBtn = document.getElementById('downloadBtn');
		const toast = document.getElementById('toast');

		let latestBlobUrl = null;

		qrForm.addEventListener('submit', async function(event) {
			event.preventDefault();

			const data = document.getElementById('qrData').value.trim();
			const size = Math.min(Math.max(parseInt(document.getElementById('qrSize').value, 10) || 320, 128), 640);
			const fg = document.getElementById('qrColor').value.replace('#', '');
			const bg = document.getElementById('qrBg').value.replace('#', '');

			if (!data) {
				showToast('Please enter text to encode.');
				return;
			}

			qrStatus.textContent = 'Generating...';
			downloadBtn.style.display = 'none';

			if (latestBlobUrl) {
				URL.revokeObjectURL(latestBlobUrl);
				latestBlobUrl = null;
			}

			const apiUrl = 'https://api.qrserver.com/v1/create-qr-code/?' + new URLSearchParams({
				data: data,
				size: size + 'x' + size,
				color: fg,
				bgcolor: bg
			}).toString();

			try {
				const response = await fetch(apiUrl, { cache: 'no-store' });
				if (!response.ok) {
					throw new Error('Network response was not ok');
				}

				const blob = await response.blob();
				latestBlobUrl = URL.createObjectURL(blob);

				const img = document.createElement('img');
				img.src = latestBlobUrl;
				img.alt = 'Generated QR code';
				img.width = size;
				img.height = size;

				qrPreviewContainer.innerHTML = '';
				qrPreviewContainer.appendChild(img);
				qrStatus.textContent = 'QR code ready. Click download or scan directly.';
				downloadBtn.style.display = 'inline-flex';

				showToast('QR code generated successfully!');
			} catch (error) {
				console.error('QR generation failed:', error);
				qrPreviewContainer.innerHTML = '<div class="qr-placeholder">Could not generate QR code. Try again.</div>';
				qrStatus.textContent = 'Generation failed. Please retry in a moment.';
				showToast('Generation failed.');
			}
		});

		downloadBtn.addEventListener('click', async function() {
			if (!latestBlobUrl) {
				showToast('No QR code to download yet.');
				return;
			}

			const link = document.createElement('a');
			link.href = latestBlobUrl;
			link.download = 'qr-code.png';
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
			showToast('Download started.');
		});

		function showToast(message) {
			toast.textContent = message;
			toast.classList.add('show');
			setTimeout(() => toast.classList.remove('show'), 2600);
		}
	</script>
</body>
</html>
